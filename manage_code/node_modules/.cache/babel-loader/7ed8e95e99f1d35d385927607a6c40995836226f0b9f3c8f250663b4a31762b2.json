{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"/Users/xinxiao/Desktop/education_ai/manage_code/node_modules/@babel/runtime/helpers/interopRequireDefault.js\")[\"default\"];\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\nvar _toConsumableArray2 = _interopRequireDefault(require(\"/Users/xinxiao/Desktop/education_ai/manage_code/node_modules/@babel/runtime/helpers/toConsumableArray.js\"));\nrequire(\"core-js/modules/es.array.map.js\");\nrequire(\"core-js/modules/es.json.stringify.js\");\nrequire(\"core-js/modules/es.array.splice.js\");\nrequire(\"core-js/modules/es.array.push.js\");\nrequire(\"core-js/modules/es.string.trim.js\");\nrequire(\"core-js/modules/es.array.find.js\");\nrequire(\"core-js/modules/es.object.to-string.js\");\nrequire(\"core-js/modules/es.array.concat.js\");\nrequire(\"core-js/modules/es.object.define-property.js\");\nvar _vue = require(\"vue\");\nvar _elementPlus = require(\"element-plus\");\nvar _default = {\n  __name: 'list',\n  setup: function setup(__props, _ref) {\n    var _getCurrentInstance;\n    var expose = _ref.expose;\n    expose();\n    var context = (_getCurrentInstance = (0, _vue.getCurrentInstance)()) === null || _getCurrentInstance === void 0 ? void 0 : _getCurrentInstance.appContext.config.globalProperties;\n\n    //权限验证\n    var btnAuth = function btnAuth(e, a) {\n      return context === null || context === void 0 ? void 0 : context.$toolUtil.isAuth(e, a);\n    };\n    var menus = (0, _vue.ref)([]);\n    var role_index = (0, _vue.ref)(0); //当前选中的角色index\n    var first_index = (0, _vue.ref)(0); //当前选中的一级菜单index\n    var collapse_default = (0, _vue.ref)([]); //展开的collapse\n    var getMenus = function getMenus() {\n      context.$http.get('menu/lists').then(function (res) {\n        menus.value = JSON.parse(res.data.data[0].menujson);\n        collapse_default.value = menus.value[role_index.value].backMenu.map(function (item) {\n          return item.menu;\n        });\n      });\n    };\n    getMenus();\n    var tabClick = function tabClick() {\n      collapse_default.value = menus.value[role_index.value].backMenu.map(function (item) {\n        return item.menu;\n      });\n    };\n    var save = function save() {\n      context.$http.post('menu/update', {\n        id: 1,\n        menujson: JSON.stringify(menus.value)\n      }).then(function (res) {\n        if (res.data.code == 0) {\n          _elementPlus.ElMessage.success('保存成功，重新登录后生效');\n        }\n      });\n    };\n    var dialogVisible = (0, _vue.ref)(false);\n    var n_first_index = (0, _vue.ref)(null); //选中的父级菜单\n    var o_index = (0, _vue.ref)(0); //需要移动的二级菜单的index\n    var toMove = function toMove(t_index, index) {\n      first_index.value = t_index;\n      n_first_index.value = t_index;\n      o_index.value = index;\n      dialogVisible.value = true;\n    };\n    var moveTo = function moveTo() {\n      var _menus$value$role_ind;\n      var items = menus.value[role_index.value].backMenu[first_index.value].child.splice(o_index.value, 1);\n      (_menus$value$role_ind = menus.value[role_index.value].backMenu[n_first_index.value].child).push.apply(_menus$value$role_ind, (0, _toConsumableArray2[\"default\"])(items));\n      dialogVisible.value = false;\n    };\n    var changeName = function changeName(row, arr) {\n      _elementPlus.ElMessageBox.prompt('请输入新菜单名', '修改菜单名', {\n        inputValidator: function inputValidator(value) {\n          if (!value || !value.trim()) return '请输入菜单名';\n          if (arr.find(function (item) {\n            return item.menu == value.trim();\n          })) {\n            return '该菜单名已存在';\n          }\n        }\n      }).then(function (_ref2) {\n        var value = _ref2.value;\n        row.menu = value.trim();\n      })[\"catch\"](function () {});\n    };\n    var moveUp = function moveUp(arr, index) {\n      var _arr;\n      if (index == 0) return;\n      (_arr = arr).splice.apply(_arr, [index - 1, 0].concat((0, _toConsumableArray2[\"default\"])(arr.splice(index, 1))));\n      arr = JSON.parse(JSON.stringify(arr));\n    };\n    var __returned__ = {\n      context: context,\n      btnAuth: btnAuth,\n      menus: menus,\n      role_index: role_index,\n      first_index: first_index,\n      collapse_default: collapse_default,\n      getMenus: getMenus,\n      tabClick: tabClick,\n      save: save,\n      dialogVisible: dialogVisible,\n      n_first_index: n_first_index,\n      o_index: o_index,\n      toMove: toMove,\n      moveTo: moveTo,\n      changeName: changeName,\n      moveUp: moveUp,\n      getCurrentInstance: _vue.getCurrentInstance,\n      ref: _vue.ref,\n      get ElMessage() {\n        return _elementPlus.ElMessage;\n      },\n      get ElMessageBox() {\n        return _elementPlus.ElMessageBox;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};\nexports[\"default\"] = _default;","map":{"version":3,"mappings":"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","names":["context","appContext","config","globalProperties","btnAuth","e","a","$toolUtil","isAuth","menus","role_index","first_index","collapse_default","getMenus","$http","get","then","value","JSON","parse","res","data","menujson","backMenu","map","item","menu","tabClick","save","post","id","stringify","code","ElMessage","success","dialogVisible","n_first_index","o_index","toMove","t_index","index","moveTo","items","child","splice","push","changeName","row","arr","ElMessageBox","prompt","inputValidator","trim","find","moveUp"],"sources":["/Users/xinxiao/Desktop/education_ai/manage_code/src/views/menu_manage/list.vue"],"sourcesContent":["<template>\r\n    <div>\r\n        <div class=\"center_view\" v-if=\"btnAuth('menu','菜单管理')\">\r\n            <div style=\"text-align: left;width: 100%;margin-bottom: 20px\">\r\n                <el-button type=\"primary\" style=\"width: 100px\" @click=\"save\">保存修改</el-button>\r\n            </div>\r\n            <el-tabs type=\"border-card\" v-model=\"role_index\" @tab-change=\"tabClick\">\r\n                <template v-for=\"(role,r_index) in menus\" :key=\"role.roleName\">\r\n                    <el-tab-pane :label=\"role.roleName\" :name=\"r_index\">\r\n                        <div v-if=\"r_index==role_index\">\r\n                            <el-collapse v-model=\"collapse_default\">\r\n                                <el-collapse-item v-for=\"(table,t_index) in role.backMenu\" :name=\"table.menu\">\r\n                                    <template #title>\r\n                                        <div style=\"width: 100%;display: flex;justify-content: space-between;align-items: center\">\r\n                                            <div style=\"font-weight: 700;font-size: 16px\">{{table.menu}}</div>\r\n                                            <div style=\"padding-right: 30px\">\r\n                                                <el-button size=\"small\" @click.stop=\"moveUp(role.backMenu,t_index)\">\r\n                                                    上移\r\n                                                </el-button>\r\n                                                <el-button size=\"small\" type=\"primary\" @click.stop=\"changeName(table,role.backMenu)\">\r\n                                                    修改菜单名\r\n                                                </el-button>\r\n                                            </div>\r\n                                        </div>\r\n                                    </template>\r\n                                    <el-table\r\n                                        :data=\"table.child\"\r\n                                        :show-header=\"false\"\r\n                                        style=\"width: 100%;background: #edeef0;border: 1px solid #ddd\">\r\n                                        <el-table-column\r\n                                            prop=\"menu\"\r\n                                            label=\"菜单名\"\r\n                                            width=\"180\">\r\n                                        </el-table-column>\r\n                                        <el-table-column label=\"权限\">\r\n                                            <template #default=\"scope\">\r\n                                                <el-checkbox-group v-model=\"scope.row.buttons\">\r\n                                                    <el-checkbox v-for=\"item in scope.row.allButtons\" :label=\"item\" :value=\"item\" />\r\n                                                </el-checkbox-group>\r\n                                            </template>\r\n                                        </el-table-column>\r\n                                        <el-table-column label=\"操作\">\r\n                                            <template #default=\"scope\">\r\n                                                <el-button size=\"small\" @click=\"moveUp(table.child,scope.$index)\">\r\n                                                    上移\r\n                                                </el-button>\r\n                                                <el-button size=\"small\" type=\"primary\" @click=\"changeName(scope.row,table.child)\">\r\n                                                    修改菜单名\r\n                                                </el-button>\r\n                                                <el-button size=\"small\"\r\n                                                           type=\"warning\"\r\n                                                           @click=\"toMove(t_index,scope.$index)\">\r\n                                                    修改父级菜单\r\n                                                </el-button>\r\n                                            </template>\r\n                                        </el-table-column>\r\n                                    </el-table>\r\n                                </el-collapse-item>\r\n                            </el-collapse>\r\n                        </div>\r\n                    </el-tab-pane>\r\n                </template>\r\n            </el-tabs>\r\n        </div>\r\n        <el-dialog\r\n            title=\"修改父级菜单\"\r\n            v-model=\"dialogVisible\"\r\n            width=\"30%\">\r\n            <div style=\"display: flex;justify-content: center;align-items: center;margin-bottom: 20px\">\r\n                <div>父级菜单：</div>\r\n                <el-select v-model=\"n_first_index\" placeholder=\"请选择父级菜单\" style=\"width: 200px\">\r\n                    <el-option\r\n                        v-for=\"(item,index) in menus[role_index].backMenu\"\r\n                        :key=\"item.menu\"\r\n                        :label=\"item.menu\"\r\n                        :value=\"index\">\r\n                    </el-option>\r\n                </el-select>\r\n            </div>\r\n            <div style=\"width: 100%;text-align: center\">\r\n                <el-button type=\"primary\" @click=\"moveTo\">确 定</el-button>\r\n            </div>\r\n        </el-dialog>\r\n    </div>\r\n</template>\r\n<script setup>\r\nimport {getCurrentInstance,ref} from \"vue\";\r\nimport { ElMessage, ElMessageBox } from 'element-plus'\r\n\r\nconst context = getCurrentInstance()?.appContext.config.globalProperties;\r\n\r\n//权限验证\r\nconst btnAuth = (e,a)=>{\r\n    return context?.$toolUtil.isAuth(e,a)\r\n}\r\n\r\nconst menus = ref([])\r\nconst role_index = ref(0)   //当前选中的角色index\r\nconst first_index = ref(0) //当前选中的一级菜单index\r\nconst collapse_default = ref([])    //展开的collapse\r\nconst getMenus = ()=>{\r\n    context.$http.get('menu/lists').then(res=>{\r\n        menus.value = JSON.parse(res.data.data[0].menujson)\r\n        collapse_default.value = menus.value[role_index.value].backMenu.map(item=>item.menu)\r\n    })\r\n}\r\ngetMenus()\r\n\r\nconst tabClick = ()=>{\r\n    collapse_default.value = menus.value[role_index.value].backMenu.map(item=>item.menu)\r\n}\r\n\r\nconst save = ()=>{\r\n    context.$http.post('menu/update',{\r\n        id:1,\r\n        menujson:JSON.stringify(menus.value)\r\n    }).then(res=>{\r\n        if(res.data.code==0){\r\n            ElMessage.success('保存成功，重新登录后生效')\r\n        }\r\n    })\r\n}\r\n\r\nconst dialogVisible = ref(false)\r\nconst n_first_index = ref(null)     //选中的父级菜单\r\nconst o_index = ref(0)      //需要移动的二级菜单的index\r\nconst toMove = (t_index,index)=>{\r\n    first_index.value = t_index\r\n    n_first_index.value = t_index\r\n    o_index.value = index\r\n    dialogVisible.value = true\r\n}\r\nconst moveTo = ()=>{\r\n    let items = menus.value[role_index.value].backMenu[first_index.value].child.splice(o_index.value,1)\r\n    menus.value[role_index.value].backMenu[n_first_index.value].child.push(...items)\r\n    dialogVisible.value = false\r\n}\r\nconst changeName = (row,arr)=>{\r\n    ElMessageBox.prompt('请输入新菜单名','修改菜单名',{\r\n        inputValidator:(value)=>{\r\n            if(!value || !value.trim())return '请输入菜单名'\r\n            if(arr.find(item=>item.menu==value.trim())){\r\n                return '该菜单名已存在'\r\n            }\r\n        },\r\n    }).then(({value})=>{\r\n        row.menu = value.trim()\r\n    }).catch(()=>{})\r\n}\r\nconst moveUp = (arr,index)=>{\r\n    if(index==0)return\r\n    arr.splice(index-1,0, ...arr.splice(index,1))\r\n    arr = JSON.parse(JSON.stringify(arr))\r\n}\r\n\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n\r\n</style>"]},"metadata":{},"sourceType":"script","externalDependencies":[]}